<!DOCTYPE html>
<html>
<head>
    <title>Youtube channel Status Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        h2 {
            margin-top: 0;
        }

        form {
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            resize: vertical;
        }

        button {
            margin-top: 10px;
        }

        #loading {
            display: none;
            font-weight: bold;
            font-size: 18px;
            color: #007bff;
        }

        #downloadLink {
            display: none;
            margin-top: 10px;
        }

        #warning {
            font-size: 14px;
            color: red;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h2>Enter YouTube Channel Links To Check Status(one link per line)(Dont Add More Than 2000 Links)</h2>
    <form id="stepFunctionForm">
        <textarea id="linksTextarea" name="links" rows="10" cols="50" required></textarea><br>
        <button type="submit">Run</button>
    </form>

    <div id="warning">Please note that the process may take up to 2 minutes to complete.</div>
    <div id="loading">Loading...</div>
    <div id="downloadLink"><a id="csvLink" href="#" download>Download CSV</a></div>

    <script>
        document.getElementById('stepFunctionForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const linksTextarea = document.getElementById('linksTextarea');
            const links = linksTextarea.value.trim().split('\n');

            const input_data = {
                "links": links
            };

            // Show the loading indicator
            const loadingDiv = document.getElementById('loading');
            loadingDiv.style.display = 'block';

            fetch('/youtube_channel_status_output', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(input_data)
            })
            .then(response => response.json())
            .then(data => {
                // Hide the loading indicator
                loadingDiv.style.display = 'none';

                const downloadLinkDiv = document.getElementById('downloadLink');
                const csvLink = document.getElementById('csvLink');

                // Parse the JSON body to get the download link
                const body = JSON.parse(data.body);
                if (body.download_link) {
                    csvLink.href = body.download_link;
                    downloadLinkDiv.style.display = 'block';
                } else {
                    downloadLinkDiv.style.display = 'none';
                }
            })
            .catch(error => {
                // Hide the loading indicator on error
                loadingDiv.style.display = 'none';
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>