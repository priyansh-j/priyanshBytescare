9359582859
9359588652
9359585238
9359581364
935958360X
9359589160
9357283234
9359584800
9359584746
9356347646
9359584002
9359583820
9362395835
9356347654
9359580988
9359581887
9357282920
9359581224
9359584959
9359586498
9362391007
9359589349
9354635539
9359585890
9357283420
9357285814
9359588520
9359583235
9355955995
9359582220
9359589888
9354635814
9359582336
9362393042
9359584614
9354635857
9362396548
9354635881
935728186X
935958486X
9354635385
9356347352
9354634435
9354635075
9359587109
9359582328
9357283706
9359589063
9359589306
9359589551
9354635377
9359585130
9359585793
9388462548
9354635679
9354635318
935463155X
B0D7ZMHJ35
9388301757
9354632491
9354236057
9389067189
9354634516
B0D5YN9NWB
9359584924
9354634699
9354635644
9389135737
938846253X
B0D86MYK61
9354635938
9359587605
9359580740
9388301773
9354634478
9389135753
9354635156
9388462645
9388462505
9359587168
9359583901
9387504026
9389135788
9354632556
9389067170
9389135745
938830165X
9354638325
9354235859
9388462556
9389067200
9354638368
9354635237
9354634540
9389510589
9354638376
B08KFW77X9
938906712X
9389510600
9389135761
9354638392
B0D5YLN4R5
9354237444
9354632580
9359586447
9354638384
9359587923
9389510562
9389510570
9357285202
9359582956
9389067154
9354635393
B08K5S2T6F
9389067162
B0D5YK6MR9
B0D5YMYBQV
9362398907
9362392879
9354635202
9359584940
9362392038
9362396580
9390180899
9362398214
9357284214
9359583421
B086XLRNDY
B086XKYJW8
9359584142
9359581550
9362392690
9359589616
9359586919
9362397412
9359588717
9357284648
9357287582
9357282025
936239099X
9362390450
9357282270
9359585726
9357287299
9359588407
9357287078
9357284400
9356349738
9357284494
9357282009
9357287264
9356345546
9357283552
9355951272
9357284257
9357282068
9356345554
935634552X
9356345503
9355954603
9356345562
9356344981
B0D5YLSTC4
9357287027
9357287086
9356345538
9354230008
9354637345
9355509545
B0D7YTK2XR
9356347603
9355954522
9355954441
9354230075
935728236X
B0B51CQ62Y
B0B51C7V14
9355959516
B09RPKV8V4
9355956339
9355509537
935423013X
B0D7ZNXKGJ
9354230083
9354234364
9362396025
9356343039
B0C8TNQK2X
9354637728
9355953321
B082F68ZDG
9355955189
935595526X
B0CKFWHQZP
B0BJVFX9NG
9357282122
9354234445
9357282343
9355950799
9355950713
B0C8TP982N
935595350X
B0C8TR7X2X
B0C5BG4HB4
9354637701
B0BB6L6QBK
B0C8TR7KDN
B0BQHGMYSJ
B0C5B7CPF5
B0C59YFGYK
B0C5B6R8MK
B0C5B177G6
B0B1PKF4MS
B0C5B4YT76
B0C5B17LFZ
B0C5B3JKPK
B0BC84RZH4
B0C59XWN6F
B0C8TRM5JH
B0C5B49L2J
935595087X
B0BC83Z4K6
B0C5K7GM2Z
B0BC7ZMRL4
B0C5RVSMB6
B0C5RV54KT
B0B1P7HW9W
9354232183
B0C5BC8PVQ
B0BC86D9T9
B0BC8541VV
B0BC7ZZTKH
B0BC83N3MV
B0BC81H1F3
9354637736
B0BC83686J
9354234844
9354232280
9354234046
935728043X
9362399016
9362398400
B0C5KM9XMY
B0C59W599F
B08241FG5X
9354233872
B08ZJHNTTH
B0BQW1M7X8
B09GYFZVY6
9355955340
B0BD47P86N
B0BB6TDDPQ
B0BQVZYQZG
B0B1PKR2WT
B09SLRJB88
B09GY8ZYWH
9355955901
B0C5B54W6R
B0BQVZWVJJ
B0BB6W8RMY
B0B1P56V66
B0BDYVSRXK
B0BDYTKZJ5
B0BDYR7YV4
B09SLVFKCB
B0B1PPJ5BZ
935463771X
B0C59ZWL5W
B0C59WR6QD
B0C53X8VB9
B0C53TMJVZ
B0BQVZDJF1
B09SLV43DB
B09GYF4D25
B0BDYS9M12
B0C5B8LHJC
9354637795
B09RRB1VYR
B0BDYV2Q33
9356347468
9359581879
9359584150
9359584185
9359582425
9359585343
9359581100
9359589411
9359582468
9359589187
9359580449
935958147X
9362393565
9356345333
B0C5RV5L3V
B0C5RWRDY6
B0C5RVYTNT
B0C5RVS9PB
B0C5B3ZH81
B0C5RX1H2H
B0C5RTXKPW
B0C5RWQYPR
B0C5RXSCXB
B0C5RVN3VS
B0C5RVS9JT
9354235476
9354233805
9356346305
9354234119
935634521X
9356346283
9356345341
9356345201
B0BQVN8PKP
9356345279
9356346275
9356346291
B0C5RW5CV9
9356345295
9356345244
B0C5B84S8G
B0BQVQYNFW
9355502575
935728074X
9357280855
9354238297
B0C5K5G1LN
B0BD3ZGVL3
B0BD46YTTV
B0BQVV3MKK
B0BQVYDP55
B0BD457VN9
B0BQVRXSFF
B0C5RWV1CM
B0C5RTF2VL
B0BD44HB1T
B0C59ZWLH5
B0C5K721J4
B0BQYC5KP2
B0C5BC8Q1V
B0C5K7248N
B0BQW8FDJ7
B0BQW6M528
B0BQW4JNW6
B0BQW4HGW8
B0BQW4GQ5P
B0BQW45J95
B0BQW2MY4C
B0BQW2LNTC
B0BQW2KWT6
B0BQW2HZD3
B0BQW2HH17
B0BQW291XT
B0BQW1ST49
B0BQW1RS4X
B0BQW1NGDQ
B0BQW1H1CY
B0BQVZVZKW
B0BQVZVZ4N
B0BQVZGRKJ
B0BQVZGDF8
B0BQVZFS84
B0BQVZDTZ5
B0BQVZDHKF
B0BQVYSPXC
B0BQVYS1QY
B0BQVYRDWF
B0BQVYRDLH
B0BQVYRCT2
B0BQVYR1GV
B0BQVYQS3H
B0BQVYQRGL
B0BQVXMPXD
B0BQVXMCN9
B0BQVXMBSM
B0BQVWSTHY
B0BQVWJXM4
B0BQVVKVF5
B0BQVVKHCX
B0BQVVJJBK
B0BQVVJ7JH
B0BQVVHM6R
B0BQVTR9KJ
B0BQVTQZGZ
B0BQVTQ96H
B0BQVTLF3K
B0BQVSLJGS
B0BQVSLJGR
B0BQVSJX4D
B0BQVRXHYN
B0BQVR2RCV
B0BQVQRBZK
B0BQVQR9XM
B0BQVQR9PQ
B0BQVPVBXQ
B0BQVP7WZK
B0BQVP6Z26
B0BQVNNGMH
B0BQVNNFXT
935958407X
9359585661
9359584061
9359580171
9359587338
9359586749
935958696X
9359585033
9359583790
9359584304
9359584398
9362391740
9357284249
9359586471
9359580945
9359588873
9359589438
9359589039
9359583650
9359583782
9359584037
9359583553
9359584533
9359586374
9357284036
9359585998
9359582506
9359581518
9359588946
9359584991
9359589284
9359581534
9359587206
9359581313
9359580260
9359584177
9359581941
9359588288
935958326X
9359582565
9359586935
9356348820
9359586412
9359588512
9357284516
9362392321
935634910X
936239913X
9359585866
9359585831
9356348812
9357284184
9356349223
9357284206
935728656X
9356349460
9359580333
9356349096
9359580554
9362398893
9357284281
9359580570
9357284419
9357284087
9359583898
9357284427
935728401X
9359585882
9357282408
9354636837
9362395428
9388462599
9356349037
9357284117
9359584703
9356349479
9357284125
935634941X
9359583863
9355951531
9356343373
9356343268
9357288791
9356349649
9356349665
9390411637
9357283900
9357283897
9357286551
9356341265
9356349053
9356343306
9356348707
9357283994
9359581526
9359580384
935958195X
9359581259
9359587680
9359585971
9359588490
9359585823
935728382X
9359580090
9359586285
9359588830
9359587095
9359583294
9359587656
9356348626
9359587532
9359588628
9356349983
9357286888
9356349967
9362392216
9359582093
9359585718
9359582271
9356349177
9359580414
9356348618
9356349207
9356349975
9356348650
9356349185
9356348634
9357281010
9357288384
9356349843
9357288341
9357281118
9357288236
9359583812
9357288244
9357288392
9357288430
9357288333
9359589691
9357288309
9359582212
9359580643
9357288295
935634986X
9356349886
9357288422
9357288376
9359581690
9356343934
B09ND4RYVK
B09NNTK7CS
B09ND5QXP1
B09RGZL14R
B09G2TW7TX
B0877ZC2PB
9356343276
9359586722
B09NSVVF58
9354231888
9362397315
B09PHD6Z6Z
9359583162
B0963X6XKM
9354632653
9362398370
9354236790
9356343799
9359585580
B08PP5V21Q
9359585165
935423187X
9356349584
9359587915
9354636365
B0CH88YH9M
9356342504
B097ZKYFBZ
9356341397
9357288481
B0BHZM85GF
B09PG1KVR1
B09HZZXKMS
9354638295
9359582662
B0CTHPJH8J
9359588776
9359581321
9359584789
9357288279
9356343977
9356348669
9357288368
9355954298
9357288260
9359589802
9356348642
935728835X
935958035X
9359588962
9362392860
9359583928
935634390X
9356344000
9355956576
9356343942
9356348677
935634387X
935958052X
9359581623
B0CKG62GT6
9356349193
9354632629
9355956215
9356349940
9359587192
9356343969
9357288449
9356343772
9355954190
9356343918
935595056X
B09G6ST7RZ
9356342490
9356343985
9357288414
9356343802
9355950144
9356343888
9354630243
B0C4YB621L
9355951701
9355950292
9359589632
9356349959
9356343829
9357288287
9356340641
9357288317
9355951620
9359581380
9355950071
9355954123
9355950454
9355954212
9356343853
9356349517
9356343993
9356343950
9354630839
9356343780
9356343896
935595154X
9354632637
9357288457
9354632718
B0C5B83R7Q
9354632815
B0C5X82L28
9354236871
9355509553
9356341389
9354630391
9354639917
9355954204
B0C53HTDRR
B0B1P2CL52
9356343861
9354231276
9356342482
9356343926
9354632769
B0BJF8Q6TC
B0BJF6VJFT
9357288473
B0C5X3YZTH
B0C5B84SPB
9354630286
9356341370
9356343748
9357288325
9354632750
B0C8TP7SBT
935463043X
9354630367
9357283269
B0BHSJ7B5L
935634406X
9359586579
B0CKG2WRY3
9389135346
B0C59ZWLVS
9354237037
B0C4Y8W1QJ
B09G2TS2DZ
B09FKCNH9L
B0C59YFGNB
B0BJVJ5MR3
9355503814
B0BJF8RDG7
B09FK9QLTR
9356344051
B0C5X5KRYV
B0C5BKWCMY
935463091X
B0D5YLVP2V
936239457X
B09GFQ3TJ4
9388462912
B07YWRWS97
B0C5X4T6WV
9359584711
9354632726
9359587311
9359581186
B0D5QNKQF6
B0C5B3YCSF
B0CKFWF122
9388462793
9388462890
B0CKG1JK1H
B0CKFWCBFX
B0CKFVVHQG
9359584401
935958097X
9356349533
9356349703
9356349541
9356349592
935634955X
9356349525
9362398753
9356349576
9359581062
9362391783
9357288678
935728334X
9357288554
9357288651
9356349312
9357281150
9356349401
9357288597
9357288686
9359585750
935728852X
9357288627
9356349568
9357288589
9359582050
9356349606
9356344329
9355952139
9359581771
9357288694
935728849X
9362392097
9356344019
9356349355
9356344043
9357288619
9357281142
9356341311
9356349363
9357288503
935634308X
9355954581
9357288538
9357288708
B0D5YL7TFP
9356344337
935728723X
9356344124
9357288511
B0D7ZP9R77
9356349320
9357288546
9359589667
9357286837
9357287248
9357288635
9359589330
9356349347
9356344280
9356349371
9355954573
9356340684
9357288570
9356344078
9356344272
9359581682
9356344108
9359580120
9356344116
9355951302
9356344302
9356349711
9354638856
935634938X
9356344035
9355954492
9355957076
B0D5YGD8FV
9354638910
9355954506
9357288643
9356344027
9356344310
9356344663
B0CZD81FHD
9354638120
9354638899
9359583766
B09G6TGBJ6
9359580422
9356343055
935595123X
935463821X
9356344132
9355952546
935728866X
9356342601
9354638414
B0D7ZNFVLL
9357288716
9355951310
9356344655
9355951264
9356343063
9362390973
9355956878
9356343071
9354637566
B0D7ZN7DNT
9356344086
9356341516
9354638090
9355951299
9354634389
9355503504
9389067014
9355503423
9354638171
9356344094
9354638724
9355957084
9356344299
9355951388
9356344256
935463835X
B0CNRSGGMS
9354639747
9356341303
935550389X
9354638287
9355502753
9354638112
9354638694
9354638589
9356344361
9356343047
9354638651
B0B1QBNJQ7
9354635555
9357283412
9354635695
B0C8TJVNTN
B0C8TSTL32
935634762X
B0BJF97SC4
B0BJF4FNP7
B0C5BCX6C6
B0C8TJVNPT
9357286365
B0C5BBH76D
B0C5X6YQV7
B0C5X6SP7G
B0BJVLW2NM
B0BJVKSLF8
B0BJVKRHK1
B0BJVK54F4
B0B1QBPFNT
B0C5X5VWRM
B0C5X58T93
B086VKZVDN
B0C5X6955V
B0C5B4YSZ5
B0BY5553YM
9359583960
B09FQ5DV7T
B0CNRRL4TP
B0BTYV4Z56
B09FQ6CJFS
B09HSGQVSQ
B09GPMBJX6
B09G6S2TMR
B09GMFGJY7
9356345368
9356345155
B09G2WCJ28
B0BZ52MLTP
9359588547
9359580198
9359586439
B0CVB2TSNL
9357282475
935728219X
B0D5YJWQXK
B0BSLLYHVS
B0BSXJ76CF
B0B7MK2SCC
B09NM7PTH5
B0C6KPNBRJ
B0BSLNVVBZ
B0B7N2DYL3
B09NM8C6TW
B09NM8CDPB
B0B7NLB5Z2
B0BLNDKTG7
B09Z6W8LDS
B0C5RV82LK
B0C53GJ2P3
B0C4YR4GT6
B0C5B4QHCC
B0BTC8C4KJ
9356348499
B0C5B9B8W9
B0B1P2CTNL
9359582654
9356345589
B0D1YJ6VBY
9356348480
9359584010
9356348472
9356347085
9357281126
9357282394
9355956584
9355952430
9354630715
B0BT7N6BHM
B0D7ZN6TWP
B0D8JYFL5Y
B0D5YY44K1
B0B9GDX26C
B0CNZ6LGVV
B0CP43VQSZ
B0CP43224B
9356347050
936239572X
9362394839
9362398311
9356346860
9356343810
9354234100
9356347417
9390180880
9355951485
B08241XJV8
9355951477
9355951469
B08SDFL7HT
9354238254
9354233953
938951018X
9354234526
9355953240
9354234607
9354234763
B0D7YTJ54M
B0D7ZNGJYH
B0D7ZN941M
B0D7ZMKZQQ
B0D7ZKV472
B0D7ZL683H
B0D7ZQW85V
9354235549
B0D7ZQ1XG9
9351277402
B01LNPWOKY
B07CXKBCQ7
B08GCTH4SR
B07CXP6SVK
B0877CSDCC
B07CXJBMCF
B07CXSB4VW
8184819080
9351277437
B07CXK8Z2J
B07CXRL36W
B07CXRWDFC
B07CXCZDT8
B07CXRMPF2
B0877DWR92
B07CXP48TK
B01LNPWO0O
B0BKVWQ54C
B09JGD5ZPK
B0877C87Q4
B07CXVG95G
B0877BRNH5
B0CQGLPLYM
B09H38CQPS
8184818998
B01LNPWNX2
B01LNPWON6
9351277399
9351277364
9351276198
B09SLV3Y61
9354234682
B08ZJQZTGN
B08ZJR9FVS
B09SLTFLPJ
B08ZJPLN3W
B08ZJHNTTF
B09SLT96D2
B08KYWQQM8
B09SLV81C2
9390411890
9390411165
B09SLTBQ11
B09SLSMYST
8184818327
B09R2773P3
9390180333
B08KYYTBZ2
B09R25R7WS
B08KYWQLP8
B08KYVBQJD
B0B2WW2NRH
B0B2X26B9T
938750445X
8184819005
9387504581
9387504573
9387504441
9387504786
B072179J3R
9387504565
9351276201
9351277410
B08GCTXY7L
9351277445
9387504387
8184819099
9351277852
8184818335
B0CBXGM7ZQ
B099N7TFPB
B099MP8FGX
9357285105
9390411718
9390411688
939041170X
B099MFVBQW
B08SM611YH
B08SM68Y59
9354233007
B08SM67K1C
B0C5B8KV55
9354232981
935423299X
B0C5B71Z9F
B0C59SYMM2
B0C59YFGMP
9354239110
9354631614
9354631606
9354631525
9354631592
9354631533
9354631517
935423819X
9354631436
9354631703
9354631681
9354631541
9354631460
B07RZLDGY4
B07SJGX4ZM
9354236987
9354237010
9354237096
9354236936
9354236995
9354237002
9354236928
935423707X
9354237088
9354237061
9359586838
9357281304
9362391759
9362395940
9359585955
B0C8TPFTBH
B0C8TPS7N9
9359585475
9359582549
9357281398
9357283625
9355959141
9357281274
9355956010
9355959265
9354637612
9355956002
9359587117
B0D5YL3BX5
9359582891
9359588156
B0B8SGHX26
B0C8TTV76P
B0BDYVLS84
B09Z82TX7Z
B09ZPJ2J5N
B0BBVY5RLQ
B09NJNLDWV
B0BBW8D347
B0B51CFD7R
B0BBW2QS7V
B0B1Q798PX
9356341834
9389510597
938913577X
9389510554
B0BQVTWCQX
B0BQVLX4QF
9390411866
939041184X
9390411785
B0BQW63VTQ
9354631630
9354239609
935423965X
9390411777
9355958919
B0BC8184F3
9355958935
9355958943
935634003X
9357287035
935728706X
9357287019
9357287051
9357288805
9357287337
9357287485
9357287442
9357287450
9357287353
9357287329
9357287345
9357287361
935958505X
9359580562
935958536X
9359587583
9359584819
935958469X
9359587230
935958391X
9359585297
9359581348
9357287434
9357287426
9357287469
9357287418
935728737X
935728740X
9357287388
9357287396
9357288813
9359589489
9359585734
9359581445
9359586854
9359580465
9359581615
935958973X
9357285148
9357284729
9357284605
9359589225
9359582778
9359581593
9359585173
9359581240
9359585637
9359581542
9359588563
935958200X
9359580147
9359588350
9359588474
9359582255
935958259X
9359580074
9359585548
935958424X
9357287884
9359589861
9359587826
9359585203
9359589373
935958584X
9359580902
9357282041
9357285555
9359582522
B0D5YJRRP6
9359582115
9359588504
B0D5YLGM8Q
9359583375
9359581569
9359583014
9359587931
9359582034
9359587818
9359583871
9359581720
9359585416
9357285172
9357285482
9357283668
9357284672
9357283331
9359589470
9359585467
9359581755
9359583324
9359585270
935958908X
9362394332
936239393X
9362395118
9362397064
9362399067
9362399369
9362396688
9362392429
9359584258
9359583774
9359586455
9359589594
9359581976
9359587265
9359584754
9359585432
9359585564
9359587494
935958617X
9359586463
9359580481
935958357X
9359585122
9359586811
9359582980
9359580066
9359588245
9359582646
9362395657
9362399318
936239622X
9362393433
9362391910
936239362X
B0D6K331HS
9362399482
9362396238
935958133X
9362391031
9357287639
9357287620
9357287655
9357287671
9357287604
935728768X
9357287647
9357287698
9357287663
935728771X
9357287612
9357287701
9351277380
9351277429
9357287728
9357287744
9357287779
9357287809
B0D5YJYKVT
9357287817
9357287825
9357287833
9357287841
935728785X
9357287868
9357287876
9357288767
9362390434
9362391163
9362395827
9362399172
9362390213
936239670X
9362398648
9362396556
9362392461
9362395231



const axios = require('axios');
const cheerio = require('cheerio');
const fs = require('fs');
const createCsvWriter = require('csv-writer').createObjectCsvWriter;

// Define keywords and pages to scrape
const keywords = [
   "9359587559",
  "9357282041",
  "9357282475",
  "9357283595",
  "9357283706",
  "9357283765",
  "9357285202",
  "9359584142",
  "9359582522",
  "9359582115",
  "9359588504",
  "9359585866",
  "9359583146",
  "9359584800",
  "935958486X",
  "9359582859",
  "9359588652",
  "9359587095",
  "9359585823",
  "9359580414",
  "9359582093",
  "9359586285",
  "9359583294",
  "9359588830",
  "9359580090",
  "9359585165",
  "9359589632",
  "9359584401",
  "935958052X",
  "9359584789",
  "9359586722",
  "9359585580",
  "9359581259",
  "9359589802",
  "9359588962",
  "9359585092",
  "9359583375",
  "9359580384",
  "9359587702",
  "9359581623",
  "935958360X",
  "9359581364",
  "9359588482",
  "9359586579",
  "9359583162",
  "9359581798",
  "9359588431",
  "9359583014",
  "9359587931",
  "9359582034",
  "9359587818",
  "9359583871",
  "9359581720",
  "9359584029",
  "935958990X",
  "9359580546",
  "9359589187",
  "9359588679",
  "9359585742",
  "9359585246",
  "9359582468",
  "9359588113",
  "9359588385",
  "9359585440",
  "9357285172",
  "9357285482",
  "935728382X",
  "9357283331",
  "9357282920",
  "9357282955",
  "9359581526",
  "9359588490"
]; // Add your keywords here

// Function to fetch and extract data
async function fetchAndExtract(keyword, page) {
    console.log(`Extracting data for ${keyword} on page ${page}`);

    let config = {
        method: 'get',
        maxBodyLength: Infinity,
        url: `https://www.amazon.in/s?k=${encodeURIComponent(keyword)}&page=${page}`,
        headers: {
            'authority': 'www.amazon.in',
            'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
            'accept-language': 'en-GB,en-US;q=0.9,en;q=0.8',
            'cache-control': 'max-age=0', 
'cookie': 'session-id=260-1265984-6802412; session-id-time=2082787201l; i18n-prefs=INR; ubid-acbin=260-2440372-3989933; csm-hit=tb:EETK7F3YXN4HYHDTK32J+s-19WG9B8JXCD0P1NQ1R59|1701677668176&t:1701677668176&adb:adblk_no; session-token=WCowmYOdSVKRrjwoE74gPZePNIY/uBovVXuo5aUu2wcMcQ+sm367nxmbgonE4bY0rwLkMhlR3nX+RL+0Bx3eh1WeHd7QaqtG7jhGUA86uRjMXXwu7QzA+K0Ux23efgEaY0Pms9wqSAQRIHn9E64Ao2sgX+PONYLfCqgXbRQNNRj23shjZANKxTszNjPfCwIeY1dSd8u16bmGGTZcromLXfEl/eqw/N11etL7DJvLvBIqqqys4BS3OTOUqvBg0b6cV29lkQy98O7DyY83SNRWknAqfBWPhPrN02l2Kb2oByfXiZymyD/5sTNBU7Y/ejDrY2m8Bcm2FnjXbQrs5mP+yQ/Eb4GTPlVo; i18n-prefs=INR; session-id=258-2804273-3616667; session-id-time=2082787201l; session-token=LCK/w6J0ZWnT+f9pLoq/NEkP//N4iC6cG9FxCTE9n7n4qt/kqiPBOMLhfonB+9y6QVDsndkbSRUHuV5uOH/T5Q7nLwhe3ZZN1I94cQtevTAkfMgmiyrpbqmVP+cuyZR7LhvivESxuFmVc1VED6gI6CuWbicBUz+kqaeKrCT5PHRl7PEoTC1u3b0fkwbM4VxoNLsYjk5l4p3OUV7MXrwWJfeewxIVy7zOASOz7L0ihTPBKG2M3m4NW6Ljs4f0Q8BsCyrvb8Stn7Q9yrHnDqEw6fgOVhz9UH5n4GRagDci1vrtY/y/VjrSi5y1hKHdOPfLaXt9hQJ3KSvOWEW86Poriy8/26o0Zj1z; ubid-acbin=257-3827892-8923301', 
'device-memory': '8', 
'downlink': '9.5', 
'dpr': '1.5', 
'ect': '4g', 
'referer': 'https://www.amazon.in/?&ext_vrnc=hi&tag=googhydrabk1-21&ref=pd_sl_7hz2t19t5c_e&adgrpid=58355126069&hvpone=&hvptwo=&hvadid=610644601173&hvpos=&hvnetw=g&hvrand=3628238165574622919&hvqmt=e&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=9062008&hvtargid=kwd-10573980&hydadcr=14453_2316415&gclid=Cj0KCQiA67CrBhC1ARIsACKAa8QJ-X8MxF9kAvILdYAfsvZqKqOM3xjX036-Mbx6X6kVttDWJSh3yF8aAnfREALw_wcB', 
'rtt': '100', 
'sec-ch-device-memory': '8', 
'sec-ch-dpr': '1.5', 
'sec-ch-ua': '"Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24"', 
'sec-ch-ua-mobile': '?0', 
'sec-ch-ua-platform': '"Windows"', 
'sec-ch-ua-platform-version': '"15.0.0"', 
'sec-ch-viewport-width': '652', 
'sec-fetch-dest': 'document', 
'sec-fetch-mode': 'navigate', 
'sec-fetch-site': 'same-origin', 
'sec-fetch-user': '?1', 
'upgrade-insecure-requests': '1', 
'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36', 
'viewport-width': '652'
        }
    };

    try {
        const response = await axios.request(config);
        const body = response.data;
        let $ = cheerio.load(body);
        let results = [];

        // Check for CAPTCHA
        let block_text = $('div#infoDiv').text();
        if (block_text.includes('solve the CAPTCHA')) {
            results.state = 'CAPTCHA_DETECTED';
            return results;
        }

        // Check for no results
        let no_results = $('.card-section > div > b');
        if (no_results.length > 0) {
            results.state = 'NO_RESULTS';
            return results;
        }

        // Process organic results
        let organic_results = $('div.s-main-slot.s-result-list > div[data-component-type="s-search-result"]:not([class*="AdHolder"])');
        organic_results.each((i, elem) => {
            let row_selector = cheerio.load($(elem).html());
            let author = row_selector('div.a-section > div.a-row.a-size-base.a-color-secondary:contains("by "):contains("|")').first().text();
            author = author.includes("by ") ? author.split("by ")[1].split("|")[0].trim().replace(/[\s\t\n]{2,64}/igs, " ") : "";
            let mrp = row_selector('span.a-price.a-text-price[data-a-size="b"][data-a-strike="true"]').first().text().trim();
            let price = row_selector('span.a-price[data-a-size="xl"]').first().text().trim();
            let href = row_selector('a.a-link-normal.a-text-normal').first().attr('href') || "";
            let asin = href.split('/dp/')[1] ? href.split('/dp/')[1].split('/')[0] : '';
            mrp = mrp.split('₹')[1] ? '₹' + mrp.split('₹')[1] : '';
            price = price.split('₹')[1] ? '₹' + price.split('₹')[1] : '';
            let title = row_selector('span.a-size-medium.a-color-base.a-text-normal').first().text().trim() ||
                row_selector('span.a-size-base-plus.a-color-base.a-text-normal').first().text().trim();
            let format = row_selector('a.a-size-base.a-link-normal.s-underline-text.s-underline-link-text.s-link-style.a-text-bold').text().trim();
            let rating = row_selector('i[data-cy="reviews-ratings-slot"] span.a-icon-alt').text().trim();
            rating = rating.split(' ')[0];

            // Construct result object
            let serp_obj = {
                title: title,
                source: "https://www.amazon.in" + (row_selector('a.a-link-normal.a-text-normal').first().attr('href') || "").split('?')[0],
                ASIN: asin,
                mrp: mrp,
                price: price,
                cover: (row_selector('img.s-image').first().attr('src') || ""),
                author: author,
                format: format,
                rating: rating
            };

            if (serp_obj.source) {
                results.push(serp_obj);
            }
        });

        return results;

    } catch (error) {
        console.error('Error:', error);
        logErrorKeyword(keyword);
        return { state: 'ERROR', results: [] };
    }
}

// Function to log error keywords
function logErrorKeyword(keyword) {
    const errorFilePath = 'error_keyword.json';
    let errorKeywords = [];

    if (fs.existsSync(errorFilePath)) {
        const errorData = fs.readFileSync(errorFilePath);
        errorKeywords = JSON.parse(errorData);
    }

    if (!errorKeywords.includes(keyword)) {
        errorKeywords.push(keyword);
        fs.writeFileSync(errorFilePath, JSON.stringify(errorKeywords, null, 2));
        console.log(`Logged error for keyword: ${keyword}`);
    }
}

// Function to iterate over keywords and pages, then save results incrementally
async function scrapeAndSaveResults() {
    const fileName = 'amazon_results.csv';

    // Initialize CSV writer
    const csvWriter = createCsvWriter({
        path: fileName,
        header: [
            { id: 'title', title: 'Title' },
            { id: 'source', title: 'Source' },
            { id: 'ASIN', title: 'ASIN' },
            { id: 'mrp', title: 'MRP' },
            { id: 'price', title: 'Price' },
            { id: 'cover', title: 'Cover' },
            { id: 'author', title: 'Author' },
            { id: 'format', title: 'Format' },
            { id: 'rating', title: 'Rating' }
        ],
        append: false // Ensure data is appended if the file exists
    });

    // Write headers only if the file does not exist
    if (!fs.existsSync(fileName)) {
        await csvWriter.writeRecords([]); // This will create the file with headers
    }

    for (let keyword of keywords) {
        for (let page = 1; page <= 1; page++) {
            let results = await fetchAndExtract(keyword, page);
            if (results.length > 0) {
                await csvWriter.writeRecords(results); // Write each batch of results to the CSV file
            }
        }
    }

    console.log('All results have been saved to CSV.');
}

scrapeAndSaveResults();











// const axios = require('axios');
// const cheerio = require('cheerio');
// const fs = require('fs');
// const createCsvWriter = require('csv-writer').createObjectCsvWriter;

// // Define keywords to scrape
// const keywords = [
  
//     "Bank Financial Management"
// ]; // Add your keywords here

// const maxPages = 10; // Maximum number of pages to scrape

// // Function to fetch and extract data
// async function fetchAndExtract(keyword, page) {
//     console.log(`Data extracted for ${keyword} for page ${page}`);

//     let config = {
//         method: 'get',
//         maxBodyLength: Infinity,
//         url: `https://www.amazon.in/s?k=${encodeURIComponent(keyword)}&page=${page}`,
//         headers: { 
//             'authority': 'www.amazon.in', 
//             'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 
       
//           },
//         //proxies: proxies,
//     };
//     try {
//         const response = await axios.request(config);
//         const body = response.data;
//         let $ = cheerio.load(body);
//         let results = [];

//         // Check for CAPTCHA
//         let block_text = $('div#infoDiv').text();
//         if (block_text.includes('solve the CAPTCHA')) {
//             results.state = 'CAPTCHA_DETECTED';
//             return results;
//         }

//         // Check for no results
//         let no_results = $('.card-section > div > b');
//         if (no_results.length > 0) {
//             results.state = 'NO_RESULTS';
//             return results;
//         }

//         // Process organic results
//         let organic_results = $('div.s-main-slot.s-result-list > div[data-component-type="s-search-result"]:not([class*="AdHolder"])');
//         organic_results.each((i, elem) => {
//             let row_selector = cheerio.load($(elem).html());
//             let author = row_selector('div.a-section > div.a-row.a-size-base.a-color-secondary:contains("by "):contains("|")').first().text();
//             author = author.includes("by ") ? author.split("by ")[1].split("|")[0].trim().replace(/[\s\t\n]{2,64}/igs, " ") : "";
//             let mrp = row_selector('span.a-price.a-text-price[data-a-size="b"][data-a-strike="true"]').first().text().trim();
//             let price = row_selector('span.a-price[data-a-size="xl"]').first().text().trim();
//             let href = row_selector('a.a-link-normal.a-text-normal').first().attr('href') || "";
//             let asin = href.split('/dp/')[1] ? href.split('/dp/')[1].split('/')[0] : '';
//             mrp = mrp.split('₹')[1] ? '₹' + mrp.split('₹')[1] : '';
//             price = price.split('₹')[1] ? '₹' + price.split('₹')[1] : '';
//             let title = row_selector('span.a-size-medium.a-color-base.a-text-normal').first().text().trim() ||
//                 row_selector('span.a-size-base-plus.a-color-base.a-text-normal').first().text().trim();
//             let format = row_selector('a.a-size-base.a-link-normal.s-underline-text.s-underline-link-text.s-link-style.a-text-bold').text().trim();
//             let rating = row_selector('i[data-cy="reviews-ratings-slot"] span.a-icon-alt').text().trim();
//             rating = rating.split(' ')[0];
//             // Construct result object
//             let serp_obj = {
//                 title: title,
//                 source: "https://www.amazon.in" + (row_selector('a.a-link-normal.a-text-normal').first().attr('href') || "").split('?')[0],
//                 ASIN: asin,
//                 mrp: mrp,
//                 price: price,
//                 cover: (row_selector('img.s-image').first().attr('src') || ""),
//                 author: author,
//                 format: format,
//                 rating: rating
//             };

//             if (serp_obj.source) {
//                 results.push(serp_obj);
//             }
//         });

//         return results;

//     } catch (error) {
//         console.error('Error:', error);
//         return { state: 'ERROR', results: [] };
//     }
// }

// // Function to iterate over keywords and pages, then save results incrementally
// async function scrapeAndSaveResults() {
//     const fileName = 'amazon_results.csv';
    
//     // Initialize CSV writer
//     const csvWriter = createCsvWriter({
//         path: fileName,
//         header: [
//             { id: 'title', title: 'Title' },
//             { id: 'source', title: 'Source' },
//             { id: 'ASIN', title: 'ASIN' },
//             { id: 'mrp', title: 'MRP' },
//             { id: 'price', title: 'Price' },
//             { id: 'cover', title: 'Cover' },
//             { id: 'author', title: 'Author' },
//             { id: 'format', title: 'Format' },
//             { id: 'rating', title: 'Rating' }
//         ],
//         append: false // Do not append, to ensure headers are written
//     });

//     // Write headers only if the file does not exist
//     if (!fs.existsSync(fileName)) {
//         await csvWriter.writeRecords([]); // This will create the file with headers
//     }

//     for (let keyword of keywords) {
//         for (let page = 1; page <= maxPages; page++) {
//             let results = await fetchAndExtract(keyword, page);
//             if (results.length > 0) {
//                 await csvWriter.writeRecords(results); // Write each batch of results to the CSV file
//             } else if (page >= 10) {
//                 break; // Break the loop if no data is found before page 10
//             }
//         }
//     }

//     console.log('All results have been saved to CSV.');
// }

// scrapeAndSaveResults();












// const axios = require('axios');
// const cheerio = require('cheerio');
// const fs = require('fs');
// const createCsvWriter = require('csv-writer').createObjectCsvWriter;

// // Define keywords to scrape
// const keywords = [
//      "Advanced Bank Management"
// ]; // Add your keywords here

// const maxPages = 2; // Maximum number of pages to scrape

// // Function to fetch and extract data
// async function fetchAndExtract(keyword, page) {
//     console.log(`Data extracted for ${keyword} for page ${page}`);

//     let config = {
//         method: 'get',
//         maxBodyLength: Infinity,
//         url: `https://www.amazon.in/s?k=${encodeURIComponent(keyword)}&page=${page}`,
//         headers: { 
//             'authority': 'www.amazon.in', 
//             'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 
//             'accept-language': 'en-GB,en-US;q=0.9,en;q=0.8', 
//             'cache-control': 'max-age=0', 
//             'cookie': 'session-id=260-1265984-6802412; session-id-time=2082787201l; i18n-prefs=INR; ubid-acbin=260-2440372-3989933; csm-hit=tb:EETK7F3YXN4HYHDTK32J+s-19WG9B8JXCD0P1NQ1R59|1701677668176&t:1701677668176&adb:adblk_no; session-token=WCowmYOdSVKRrjwoE74gPZePNIY/uBovVXuo5aUu2wcMcQ+sm367nxmbgonE4bY0rwLkMhlR3nX+RL+0Bx3eh1WeHd7QaqtG7jhGUA86uRjMXXwu7QzA+K0Ux23efgEaY0Pms9wqSAQRIHn9E64Ao2sgX+PONYLfCqgXbRQNNRj23shjZANKxTszNjPfCwIeY1dSd8u16bmGGTZcromLXfEl/eqw/N11etL7DJvLvBIqqqys4BS3OTOUqvBg0b6cV29lkQy98O7DyY83SNRWknAqfBWPhPrN02l2Kb2oByfXiZymyD/5sTNBU7Y/ejDrY2m8Bcm2FnjXbQrs5mP+yQ/Eb4GTPlVo; i18n-prefs=INR; session-id=258-2804273-3616667; session-id-time=2082787201l; session-token=LCK/w6J0ZWnT+f9pLoq/NEkP//N4iC6cG9FxCTE9n7n4qt/kqiPBOMLhfonB+9y6QVDsndkbSRUHuV5uOH/T5Q7nLwhe3ZZN1I94cQtevTAkfMgmiyrpbqmVP+cuyZR7LhvivESxuFmVc1VED6gI6CuWbicBUz+kqaeKrCT5PHRl7PEoTC1u3b0fkwbM4VxoNLsYjk5l4p3OUV7MXrwWJfeewxIVy7zOASOz7L0ihTPBKG2M3m4NW6Ljs4f0Q8BsCyrvb8Stn7Q9yrHnDqEw6fgOVhz9UH5n4GRagDci1vrtY/y/VjrSi5y1hKHdOPfLaXt9hQJ3KSvOWEW86Poriy8/26o0Zj1z; ubid-acbin=257-3827892-8923301', 
//             'device-memory': '8', 
//             'downlink': '9.5', 
//             'dpr': '1.5', 
//             'ect': '4g', 
//             'referer': 'https://www.amazon.in/?&ext_vrnc=hi&tag=googhydrabk1-21&ref=pd_sl_7hz2t19t5c_e&adgrpid=58355126069&hvpone=&hvptwo=&hvadid=610644601173&hvpos=&hvnetw=g&hvrand=3628238165574622919&hvqmt=e&hvdev=c&hvdvcmdl=&hvlocint=&hvlocphy=9062008&hvtargid=kwd-10573980&hydadcr=14453_2316415&gclid=Cj0KCQiA67CrBhC1ARIsACKAa8QJ-X8MxF9kAvILdYAfsvZqKqOM3xjX036-Mbx6X6kVttDWJSh3yF8aAnfREALw_wcB', 
//             'rtt': '100', 
//             'sec-ch-device-memory': '8', 
//             'sec-ch-dpr': '1.5', 
//             'sec-ch-ua': '"Google Chrome";v="119", "Chromium";v="119", "Not?A_Brand";v="24"', 
//             'sec-ch-ua-mobile': '?0', 
//             'sec-ch-ua-platform': '"Windows"', 
//             'sec-ch-ua-platform-version': '"15.0.0"', 
//             'sec-ch-viewport-width': '652', 
//             'sec-fetch-dest': 'document', 
//             'sec-fetch-mode': 'navigate', 
//             'sec-fetch-site': 'same-origin', 
//             'sec-fetch-user': '?1', 
//             'upgrade-insecure-requests': '1', 
//             'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36', 
//             'viewport-width': '652'
//           },
//         //proxies: proxies,
//     };
//     try {
//         const response = await axios.request(config);
//         const body = response.data;
//         let $ = cheerio.load(body);
//         let results = [];

//         // Check for CAPTCHA
//         let block_text = $('div#infoDiv').text();
//         if (block_text.includes('solve the CAPTCHA')) {
//             results.state = 'CAPTCHA_DETECTED';
//             return results;
//         }

//         // Check for no results
//         let no_results = $('.card-section > div > b');
//         if (no_results.length > 0) {
//             results.state = 'NO_RESULTS';
//             return results;
//         }

//         // Process organic results
//         let organic_results = $('div.s-main-slot.s-result-list > div[data-component-type="s-search-result"]:not([class*="AdHolder"])');
//         organic_results.each((i, elem) => {
//             let row_selector = cheerio.load($(elem).html());
//             let author = row_selector('div.a-section > div.a-row.a-size-base.a-color-secondary:contains("by "):contains("|")').first().text();
//             author = author.includes("by ") ? author.split("by ")[1].split("|")[0].trim().replace(/[\s\t\n]{2,64}/igs, " ") : "";
//             let mrp = row_selector('span.a-price.a-text-price[data-a-size="b"][data-a-strike="true"]').first().text().trim();
//             let price = row_selector('span.a-price[data-a-size="xl"]').first().text().trim();
//             let href = row_selector('a.a-link-normal.a-text-normal').first().attr('href') || "";
//             let asin = href.split('/dp/')[1] ? href.split('/dp/')[1].split('/')[0] : '';
//             mrp = mrp.split('₹')[1] ? '₹' + mrp.split('₹')[1] : '';
//             price = price.split('₹')[1] ? '₹' + price.split('₹')[1] : '';
//             let title = row_selector('span.a-size-medium.a-color-base.a-text-normal').first().text().trim() ||
//                 row_selector('span.a-size-base-plus.a-color-base.a-text-normal').first().text().trim();
//             let format = row_selector('a.a-size-base.a-link-normal.s-underline-text.s-underline-link-text.s-link-style.a-text-bold').text().trim();
//             let rating = row_selector('i[data-cy="reviews-ratings-slot"] span.a-icon-alt').text().trim();
//             rating = rating.split(' ')[0];

//             // Construct result object
//             let serp_obj = {
//                 title: title,
//                 source: "https://www.amazon.in" + (row_selector('a.a-link-normal.a-text-normal').first().attr('href') || "").split('?')[0],
//                 ASIN: asin,
//                 mrp: mrp,
//                 price: price,
//                 cover: (row_selector('img.s-image').first().attr('src') || ""),
//                 author: author,
//                 format: format,
//                 rating: rating
//             };

//             if (serp_obj.source) {
//                 results.push(serp_obj);
//             }
//         });

//         return results;

//     } catch (error) {
//         console.error('Error:', error);
//         return { state: 'ERROR', results: [] };
//     }
// }

// // Function to iterate over keywords and pages, then save results incrementally
// async function scrapeAndSaveResults() {
//     const fileName = 'amazon_results.csv';
    
//     // Initialize CSV writer
//     const csvWriter = createCsvWriter({
//         path: fileName,
//         header: [
//             { id: 'title', title: 'Title' },
//             { id: 'source', title: 'Source' },
//             { id: 'ASIN', title: 'ASIN' },
//             { id: 'mrp', title: 'MRP' },
//             { id: 'price', title: 'Price' },
//             { id: 'cover', title: 'Cover' },
//             { id: 'author', title: 'Author' },
//             { id: 'format', title: 'Format' },
//             { id: 'rating', title: 'Rating' }
//         ],
//         append: true // Ensure data is appended if the file exists
//     });

//     // Write headers only if the file does not exist
//     if (!fs.existsSync(fileName)) {
//         await csvWriter.writeRecords([]); // This will create the file with headers
//     }

//     for (let keyword of keywords) {
//         for (let page = 1; page <= maxPages; page++) {
//             let results = await fetchAndExtract(keyword, page);
//             if (results.length > 0) {
//                 await csvWriter.writeRecords(results); // Write each batch of results to the CSV file
//             } else if (page >= 10) {
//                 break; // Break the loop if no data is found before page 10
//             }
//         }
//     }

//     console.log('All results have been saved to CSV.');
// }

// scrapeAndSaveResults();
